{% extends 'dssgmkt/org.html' %}

{% block tabcontents %}

  <h4 class="section-header">Staff members</h4>
  {% if organization_staff %}
    <table class="table table-hover">
      <thead>
        <tr>
            <th>Full name</th>
            <th>Email address</th>
            <th>Role</th>
            <th>Member since</th>
            {% if user_is_administrator %}
            <th>Edit</th>
            <th>Remove</th>
            {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for staff in organization_staff %}
          <tr>
              <td><a href="{% url 'dssgmkt:user_profile' staff.user.id %}">{{ staff.user.first_name }} {{ staff.user.last_name }}</a></td>
              <td><a href="{% url 'dssgmkt:user_profile' staff.user.id %}">{{ staff.user.email }}</a></td>
              <td>{{ staff.get_role_display }}</td>
              <td>{{ staff.creation_date }}</td>
              {% if user_is_administrator %}
              <td><a href="{% url 'dssgmkt:org_staff_edit' staff.organization.id staff.id %}">Edit</a></td>
              <td><a href="{% url 'dssgmkt:org_staff_remove' staff.organization.id staff.id %}">Remove</a></td>
              {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
    {% url 'dssgmkt:org_staff' as org_staff_url %}
    {% include 'dssgmkt/components/pagination.html' with baseurl=org_staff_url page_obj=organization_staff pagename='staff_page' %}
  {% else %}
    <p>No staff found.</p>
  {% endif %}

  {% if user_is_administrator %}
    <h4 class="section-header">Add staff member</h4>
    <form id="addstaff" class="form-inline">
      {% if form.subject.errors %}
        <ol>
        {% for error in form.subject.errors %}
            <li><strong>{{ error|escape }}</strong></li>
        {% endfor %}
        </ol>
      {% endif %}

      {% csrf_token %}

      {% load widget_tweaks %}

      {% for field in add_staff_form %}
        {% if field.errors %}
            <div class="form-group has-error">
                <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                <div class="col-sm-2">
                    {{ field|attr:"class:form-control" }}
                    <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                </div>
            </div>
        {% else %}
            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
            <div class="col-sm-2">
                {{ field|attr:"class:form-control" }}
                {% if field.help_text %}
                    <p class="help-block"><small>{{ field.help_text }}</small></p>
                {% endif %}
            </div>
        {% endif %}
      {% endfor %}
      <div class="form-group col-lg-3">
        <div>
          <button type="submit"
                  form="addstaff"
                  formaction="{% url 'dssgmkt:org_staff' organization.id %}"
                  formmethod="post"
                  class="btn btn-success">
            Add staff member
          </button>
        </div>
      </div>
    </form>
  {% endif %}

  <h4 class="section-header">Organization membership requests</h4>
  {% if organization_requests %}
    <table class="table table-hover">
      <thead>
        <tr>
            <th>Full name</th>
            <th>Email address</th>
            <th>Request date</th>
            <th>Status</th>
            <th>Resolution date</th>
        </tr>
      </thead>
      <tbody>
        {% for request in organization_requests %}
          <tr>
              <td><a href="{% url 'dssgmkt:user_profile' request.user.id %}">{{ request.user.first_name }} {{ request.user.last_name }}</a></td>
              <td><a href="{% url 'dssgmkt:user_profile' request.user.id %}">{{ request.user.email }}</a></td>
              <td>{{ request.request_date }}</td>
              <td><a href="{% url 'dssgmkt:org_staff_request_review' organization.id request.id %}">{{ request.get_status_display }}</a></td>
              <td>{% if not request.is_new %}
                    {{ request.resolution_date|default_if_none:"" }}
                  {% endif %}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    {% url 'dssgmkt:org_staff' as org_staff_url %}
    {% include 'dssgmkt/components/pagination.html' with baseurl=org_staff_url page_obj=organization_requests pagename='requests_page' %}
  {% else %}
    <p>No requests found.</p>
  {% endif %}
{% endblock %}
