{% extends "dssgmkt/proj.html" %}

{% block tabcontents %}


  <div class="row mt-5 mb-5">
    <div class="col-lg-8">
      <h3>Project description</h3>
      <h4 class="section-header">Context and motivation</h4>
      <p>{{ project.motivation }}</p>
      <h4 class="section-header">Proposed solution</h4>
      <p>{{ project.solution_description }}</p>
      <h4 class="section-header">Main challenges</h4>
      <p>{{ project.challenges }}</p>
    </div>

    <div class="col-lg-4">
      {% if not project.is_completed %}
        <form id="followproject">
          {% csrf_token %}
          <button type="submit"
                  form="followproject"
                  formaction="{% url 'dssgmkt:proj_follow' project.id %}"
                  formmethod="post"
                  class="btn btn-success col-lg-12 mb-1">
            {% if user_is_following_project %}
              <i class="material-icons" style="vertical-align: middle">visibility_off</i>
              Unfollow project
            {% else %}
              <i class="material-icons" style="vertical-align: middle">visibility</i>
              Follow project
            {% endif %}
          </button>
        </form>
      {% endif %}
      {% load rules %}
      {% has_perm 'project.publish' user project as perm_publish %}
      {% if perm_publish and project.is_draft_status %}
        <a class="btn btn-success col-lg-12 mb-1"
           href="{% url 'dssgmkt:proj_publish' project.id %}">
          <i class="material-icons" style="vertical-align: middle">publish</i>
          Publish project
        </a>
      {% endif %}

      {% has_perm 'project.approve_as_completed' user project as perm_approve %}
      {% if perm_approve and project.is_waiting_review_status %}
        <a class="btn btn-success col-lg-12 mb-1"
           href="{% url 'dssgmkt:proj_finish' project.id %}">
          <i class="material-icons" style="vertical-align: middle">done_all</i>
          Finish project
        </a>
      {% endif %}

      {% has_perm 'project.information_edit' user project as perm_information_edit %}
      {% if perm_information_edit %}
        <a class="btn btn-success col-lg-12 mb-1"
           href="{% url 'dssgmkt:proj_info_edit' project.id %}">
          <i class="material-icons" style="vertical-align: middle">edit</i>
          Edit project information
        </a>
      {% endif %}

      <div class="card mb-3 section-header">
        <div class="card-header">Schedule</div>
        <div class="card-body">
          <p>Start date: {% if project.actual_start_date %}{{ project.actual_start_date }}{% else %}{{ project.intended_start_date }}{% endif %}</p>
          <p>End date: {% if project.actual_end_date %}{{ project.actual_end_date }}{% else %}{{ project.intended_end_date }}{% endif %}</p>
        </div>
      </div>


        <h3 class="section-header text-center">Project tasks</h3>
        {% if project_tasks %}
          {% for project_task in project_tasks %}
            {% if not project_task.is_completed %}
              <div class="card mb-3">
                <div class="card-header"> {{ project_task.name }}</div>

                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">{{ project_task.description }}</li>
                    <li class="list-group-item">Required skills:
                      {% for task_requirement in project_task.projecttaskrequirement_set.all %}
                        <div>{{ task_requirement.skill.area }}/{{ task_requirement.skill.name }}:{{ task_requirement.get_level_display }}</div>
                      {% endfor %}
                    </li>
                    <li class="list-group-item">
                      {# TODO show a message "You have applied to this task" instead of the link when the user has applied already #}
                      {% if project_task.accepting_volunteers %}
                        <a class="btn btn-success col-lg-12" href="{% url 'dssgmkt:proj_task_apply' project.id project_task.id %}">
                          <i class="material-icons" style="vertical-align: middle">how_to_vote</i>
                          Apply to volunteer
                        </a>
                      {% else %}
                        <a class="btn btn-light disabled col-lg-12 mb-1">
                          <i class="material-icons" style="vertical-align: middle">hourglass_empty</i>
                          Task not currently accepting volunteers
                        </a>
                      {% endif %}
                    </li>
                  </ul>
              </div>
            {% else %}
              <div class="mb-1">
                <i class="material-icons" style="vertical-align: middle">check</i>{{ project_task.name }}
              </div>
            {% endif %}
          {% endfor %}
        {% else %}
          <p>This project does not have any tasks at this moment.</p>
        {% endif %}
    </div>
  </div>


{% endblock %}
